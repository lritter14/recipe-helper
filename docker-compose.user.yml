# Minimal docker-compose for recipe-helper service only
# All configuration via environment variables

services:
  recipe-helper:
    image: ${RECIPE_HELPER_IMAGE:-recipe-helper}:${RECIPE_HELPER_TAG:-latest}
    container_name: recipe-helper-api
    env_file:
      - .env
    volumes:
      - recipe-helper-data:/app/data
      - ${VAULT_PATH:-/home/lritter/Documents/Obsidian/Personal}:/vault
      - ${CONFIG_PATH:-./config}:/app/config:ro
    restart: unless-stopped
    environment:
      # Port configuration (defaults to 8001 if not set in .env)
      - API_PORT=${API_PORT:-8001}
      # Application configuration
      - RECIPE_INGEST_LOG_LEVEL=${RECIPE_INGEST_LOG_LEVEL:-INFO}
      - RECIPE_INGEST_LLM_ENDPOINT=${RECIPE_INGEST_LLM_ENDPOINT:-http://ollama:11434}
      - RECIPE_INGEST_LLM_MODEL=${RECIPE_INGEST_LLM_MODEL:-llama3.1:8b}
      - RECIPE_INGEST_LLM_TIMEOUT=${RECIPE_INGEST_LLM_TIMEOUT:-120}
      - RECIPE_INGEST_VAULT_PATH=${RECIPE_INGEST_VAULT_PATH:-/vault}
      - RECIPE_INGEST_VAULT_RECIPES_DIR=${RECIPE_INGEST_VAULT_RECIPES_DIR:-personal/recipes}
    ports:
      - "${API_PORT:-8001}:${API_PORT:-8001}"
    healthcheck:
      test: ["CMD-SHELL", "python -c \"import urllib.request, os; port=os.getenv('API_PORT', '8001'); urllib.request.urlopen(f'http://localhost:{port}/api/v1/health', timeout=5)\""]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

volumes:
  recipe-helper-data:
    driver: local
